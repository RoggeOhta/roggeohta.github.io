<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>异星工厂(Factorio)中量化设计的数学</title>
      <link href="/yi-xing-gong-han-factorio-zhong-liang-hua-she-ji-de-shu-xue.html"/>
      <url>/yi-xing-gong-han-factorio-zhong-liang-hua-she-ji-de-shu-xue.html</url>
      
        <content type="html"><![CDATA[<p>玩异星工厂一段时间了，一直对异星工厂中一个广受欢迎的Mod——Helmod中的自动量化设计很感兴趣。这是一个非常常用且强大的Mod，能帮助玩家自动完成很多量化设计的计算。今天闲得无聊，想办法自己实现一下。</p><h2 id="问题介绍"><a href="#问题介绍" class="headerlink" title="问题介绍"></a>问题介绍</h2><p>异星工厂中的典型问题通常是这样的</p><p><strong>一条流水线有多个加工机器同时工作，在单位时间内:<br>机器A使用a份材料1，产出b份中间产品1，c分中间产品2<br>机器B使用b份中间产品1，产出c份中间产品3<br>机器C使用d份中间产品3，最终产出最终产品</strong></p><p>对于这个模型，可以提出很多问题，最常用，也是最有用的问题通常是：我可以分配出N份材料输入进产线，如何搭配机器使得其能刚好用完所有中间产品防止堆积。(因为游戏中产品没有及时处理掉产生堆积会导致机器无法运行，进而导致整个产线停工。)</p><h2 id="约束输入时如何搭配机器使中间产品刚好用完"><a href="#约束输入时如何搭配机器使中间产品刚好用完" class="headerlink" title="约束输入时如何搭配机器使中间产品刚好用完"></a>约束输入时如何搭配机器使中间产品刚好用完</h2><p>我们以这个配方为例<br><img src="http://qf3u9flyn.hn-bkt.clouddn.com/Snipaste_2020-08-18_15-56-06.png"></p><p>这是一个化工序列的配方，输入原煤，输出燃气作为产品，我们忽略产品的输出，只计算中间产品，单位时间为分钟：<br>第一个工厂输入300原煤，输出90煤作为中间产品 <code>注意：煤不等于原煤，煤是原煤的产品</code><br>第二个工厂输入200煤，输出120焦炭为中间产品<br>第三个工厂输入240焦炭</p><p>现在我们的问题就是在输入的原煤固定时，使中间产品<strong>煤，焦炭</strong>全部用完</p><p>使用矩阵建模可以得到一个Ax=b形式的等式<br><img src="http://qf3u9flyn.hn-bkt.clouddn.com/1597740946967.png"></p><p>这里的矩阵A就是配方矩阵，其中每一列代表一个配方，每一行代表一种材料<br>此处的Input就是我们的输入值，有一点要注意这个Input必须输入一个负数。比如输入是3000原煤，这里就要输入-3000.</p><p>我比较懒，计算部分就直接用Mathematica算了。<br>随便试一个数字，7299吧<br><img src="http://qf3u9flyn.hn-bkt.clouddn.com/1597741167547.png"><br><img src="http://qf3u9flyn.hn-bkt.clouddn.com/1597741191832.png"><br>向上取整后和游戏Mod中结果一致，Good.</p><h2 id="更进一步：通过配方计算最优配比"><a href="#更进一步：通过配方计算最优配比" class="headerlink" title="更进一步：通过配方计算最优配比"></a>更进一步：通过配方计算最优配比</h2><p>这个Mod可以帮我们通过输入约束计算出消耗完中间产品的配比，但是不是所有配比都是最优配比。因为很多比例能用完所有产品都是通过冗余消耗做到的。说白了就是用不完，哪怕只剩一点点我也再加一台机器把他用完。这样做的缺点很明显，就是总有机器无法全功率运行。<br>Mod并没有提供通过配方计算完美比例的方法，所以我决定在刚刚研究的基础上更进一步，找到一个计算配方最优比例的通用方法。</p><p>依旧是通过矩阵进行建模，只不过这次我们不需要输入约束了。所以可以完全不考虑输入的多少，只考虑如何配比能用完所有中间产品。<br><img src="http://qf3u9flyn.hn-bkt.clouddn.com/1597741531419.png"></p><p>这个矩阵相当于方程组<br><img src="http://qf3u9flyn.hn-bkt.clouddn.com/1597742206265.png"></p><p>3个未知数，方程的结果还等于0.</p><p>这里需要用到线性代数中解零空间的知识。</p><p>先对这个配方矩阵进行行约化，找到其自由变量。<br><img src="http://qf3u9flyn.hn-bkt.clouddn.com/1597742287066.png"></p><p>可以看到自由变量在第三列，设置第三个未知数z为1求特解。<br>通过重新设置未知数，得到了一个新的方程组<br><img src="http://qf3u9flyn.hn-bkt.clouddn.com/1597742370655.png"></p><p>现在这个方程组是可解的了，求解得到结果<br><img src="http://qf3u9flyn.hn-bkt.clouddn.com/1597742432238.png"></p><p>结果有分数，这里将他们都整数化，全部乘以9得到最终结果，完美配比是$40:18:9$</p><p>验证一下：<br><img src="http://qf3u9flyn.hn-bkt.clouddn.com/1597742538878.png"><br><img src="http://qf3u9flyn.hn-bkt.clouddn.com/1597742581754.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 数学 </tag>
            
            <tag> 线性代数 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
